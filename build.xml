<project default="compile">

  <property name="rootdir" location="${basedir}"/>
  <property name="vtkrootdir" location="/home/kahneg1/src/near/vtk_all_platforms"/>

  <target name="compile">
    <echo>$${rootdir}=${rootdir}</echo>
    <mkdir dir="${rootdir}/build/classes"/>
    <mkdir dir="${rootdir}/build/classes/edu"/>
    <mkdir dir="${rootdir}/build/classes/edu/jhuapl"/>
    <mkdir dir="${rootdir}/build/classes/edu/jhuapl/near"/>
    <mkdir dir="${rootdir}/build/classes/edu/jhuapl/near/data"/>
    <exec executable="sh" output="build/classes/svn.version" failifexecutionfails="false">
      <arg value="-c"/>
      <!-- <arg value="svn info | grep -i 'Last Changed Date'"/> -->
      <arg value="echo Last Changed Date: `date +%F`"/>
    </exec>
    <copy todir="${rootdir}/build/classes/edu/jhuapl/near/data">
      <fileset dir="${rootdir}/src/edu/jhuapl/near/data"/>
    </copy>
    <javac srcdir="${rootdir}/src"
		   destdir="${rootdir}/build/classes"
		   debug="off" >
      <classpath>
		<pathelement location="${rootdir}/lib/vtksb.jar"/>
		<pathelement location="${rootdir}/lib/vtk.jar"/>
		<pathelement location="${rootdir}/lib/jide-oss-2.7.3.jar"/>
		<pathelement location="${rootdir}/lib/joda-time-1.6.jar"/>
		<pathelement location="${rootdir}/lib/jcommon-1.0.16.jar"/>
		<pathelement location="${rootdir}/lib/jfreechart-1.0.13.jar"/>
		<pathelement location="${rootdir}/lib/miglayout-3.7.1-swing.jar"/>
		<pathelement location="${rootdir}/lib/commons-io-2.0.jar"/>
		<pathelement location="${rootdir}/lib/commons-math-2.2.jar"/>
		<pathelement location="${rootdir}/lib/h2-1.3.162.jar"/>
		<pathelement location="${rootdir}/lib/fits-1.04.0.jar"/>
		<pathelement location="${rootdir}/lib/jgoodies-common-1.1.1.jar"/>
		<pathelement location="${rootdir}/lib/jgoodies-looks-2.4.0.jar"/>
      </classpath>
    </javac>
  </target>

  <target name="jarapl" depends="compile">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/near-apl.jar" basedir="${rootdir}/build/classes">
      <manifest>
        <attribute name="Class-Path" value="vtksb.jar
											vtk.jar
											jide-oss-2.7.3.jar
											joda-time-1.6.jar
                                            jcommon-1.0.16.jar
                                            jfreechart-1.0.13.jar
                                            miglayout-3.7.1-swing.jar
                                            commons-io-2.0.jar
                                            commons-math-2.2.jar
                                            h2-1.3.162.jar
                                            fits-1.04.0.jar
                                            jgoodies-common-1.1.1.jar
                                            jgoodies-looks-2.4.0.jar"/>
        <attribute name="Main-Class" value="edu.jhuapl.near.SmallBodyMappingToolAPL"/>
      </manifest>
    </jar>
  </target>

  <target name="jar" depends="compile">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/near.jar"
         basedir="${rootdir}/build/classes"
         excludes="edu/jhuapl/near/data/LinearFeatures.txt
                   edu/jhuapl/near/SmallBodyMappingToolAPL.class">
      <manifest>
        <attribute name="Class-Path" value="vtksb.jar
											vtk.jar
											jide-oss-2.7.3.jar
											joda-time-1.6.jar
                                            jcommon-1.0.16.jar
                                            jfreechart-1.0.13.jar
                                            miglayout-3.7.1-swing.jar
                                            commons-io-2.0.jar
                                            commons-math-2.2.jar
                                            h2-1.3.162.jar
                                            fits-1.04.0.jar
                                            jgoodies-common-1.1.1.jar
                                            jgoodies-looks-2.4.0.jar"/>
        <attribute name="Main-Class" value="edu.jhuapl.near.SmallBodyMappingTool"/>
      </manifest>
    </jar>
  </target>

  <target name="nativelinuxvtkjar">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/vtk-natives-linux-i586.jar" basedir="${vtkrootdir}/linux32">
      <manifest>
      </manifest>
    </jar>
  </target>

  <target name="nativelinux64vtkjar">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/vtk-natives-linux-amd64.jar" basedir="${vtkrootdir}/linux64">
      <manifest>
      </manifest>
    </jar>
  </target>

  <target name="nativewinvtkjar">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/vtk-natives-windows-i586.jar" basedir="${vtkrootdir}/win32">
      <manifest>
      </manifest>
    </jar>
  </target>

  <target name="nativemac64vtkjar">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/vtk-natives-macosx-x86_64.jar" basedir="${vtkrootdir}/mac64">
      <manifest>
      </manifest>
    </jar>
  </target>

  <target name="compilevtksb">
    <echo>$${rootdir}=${rootdir}</echo>
    <mkdir dir="${rootdir}/build/vtksbclasses"/>
    <mkdir dir="${rootdir}/build/vtksbclasses/vtk"/>
    <javac srcdir="${vtkrootdir}/java"
		   destdir="${rootdir}/build/vtksbclasses"
		   debug="off" >
      <classpath>
		<pathelement location="${rootdir}/lib/vtk.jar"/>
      </classpath>
    </javac>
  </target>

  <target name="vtksbjar" depends="compilevtksb">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/vtksb.jar" basedir="${rootdir}/build/vtksbclasses">
      <manifest>
        <attribute name="Class-Path" value="vtk.jar"/>
      </manifest>
    </jar>
  </target>

  <target name="nativequaquajar">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/libquaqua64.jnilib-7.3.4.jar" basedir="${rootdir}/lib/quaqua">
      <manifest>
      </manifest>
    </jar>
  </target>


  <!--

      The next target assumes that you have file named "keystore" in
      the root directory which was created using the java keytool
      command with the alias called "mykey". For example, I used the
      command while in rootdir

      ${JAVA_HOME}/bin/keytool -genkey -keystore keystore -validity 1000000

    -->
  <target name="signjar" depends="jar,jarapl">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/near.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
    <signjar jar="${rootdir}/build/jar/near-apl.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signvtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/vtk.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signnativelinuxvtkjar" depends="nativelinuxvtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/vtk-natives-linux-i586.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signnativelinux64vtkjar" depends="nativelinux64vtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/vtk-natives-linux-amd64.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signnativewinvtkjar" depends="nativewinvtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/vtk-natives-windows-i586.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signnativemac64vtkjar" depends="nativemac64vtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/vtk-natives-macosx-x86_64.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signjidejar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/jide-oss-2.7.3.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signjodatimejar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/joda-time-1.6.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signjcommon">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/jcommon-1.0.16.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signjfreechart">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/jfreechart-1.0.13.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signmiglayout">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/miglayout-3.7.1-swing.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signcommonsio">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/commons-io-2.0.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signcommonsmath">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/commons-math-2.2.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signh2">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/h2-1.3.162.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signfits">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/fits-1.04.0.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signquaqua">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/quaqua-7.3.4.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signquaqua-filechooser">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/quaqua-7.3.4-filechooser-only.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signnativequaqua" depends="nativequaquajar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/libquaqua64.jnilib-7.3.4.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signjgoodiescommon">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/jgoodies-common-1.1.1.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signjgoodieslooks">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/jgoodies-looks-2.4.0.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signvtksb" depends="vtksbjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/vtksb.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>


  <target name="clean">
    <delete dir="${rootdir}/build"/>
  </target>

</project>
