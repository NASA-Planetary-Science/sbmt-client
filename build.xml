<project default="compile">

  <property name="rootdir" location="${basedir}"/>

  <target name="compile">
    <echo>$${rootdir}=${rootdir}</echo>
    <mkdir dir="${rootdir}/build/classes"/>
    <mkdir dir="${rootdir}/build/classes/edu"/>
    <mkdir dir="${rootdir}/build/classes/edu/jhuapl"/>
    <mkdir dir="${rootdir}/build/classes/edu/jhuapl/near"/>
    <mkdir dir="${rootdir}/build/classes/edu/jhuapl/near/data"/>
    <copy todir="${rootdir}/build/classes/edu/jhuapl/near/data">
      <fileset dir="${rootdir}/src/edu/jhuapl/near/data"/>
    </copy>
    <javac srcdir="${rootdir}/src"
		   destdir="${rootdir}/build/classes"
		   excludes="edu/jhuapl/near/dbgen/**"
		   debug="off" >
      <classpath>
		<pathelement location="${rootdir}/lib/vtk.jar"/>
		<pathelement location="${rootdir}/lib/jide-oss-2.7.3.jar"/>
		<pathelement location="${rootdir}/lib/joda-time-1.6.jar"/>
		<pathelement location="${rootdir}/lib/jcommon-1.0.16.jar"/>
		<pathelement location="${rootdir}/lib/jfreechart-1.0.13.jar"/>
		<pathelement location="${rootdir}/lib/miglayout-3.7.1-swing.jar"/>
      </classpath>
    </javac> 
  </target>

  <target name="run" depends="compile">
    <java classname="edu.jhuapl.near.ErosViewer" fork="true" maxmemory="512m">
      <jvmarg value="-Djava.library.path=${rootdir}/lib/linux32"/>
      <jvmarg value="-Dsun.java2d.noddraw=true"/>
      <classpath>
		<pathelement location="${rootdir}/build/classes"/>
		<pathelement location="${rootdir}/lib/vtk.jar"/>
		<pathelement location="${rootdir}/lib/jide-oss-2.7.3.jar"/>
		<pathelement location="${rootdir}/lib/joda-time-1.6.jar"/>
		<pathelement location="${rootdir}/lib/jcommon-1.0.16.jar"/>
		<pathelement location="${rootdir}/lib/jfreechart-1.0.13.jar"/>
		<pathelement location="${rootdir}/lib/miglayout-3.7.1-swing.jar"/>
      </classpath>
    </java>
  </target>

  <target name="jar" depends="compile">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/near.jar" basedir="${rootdir}/build/classes">
      <manifest>
        <attribute name="Class-Path" value="vtk.jar
											jide-oss-2.7.3.jar
											joda-time-1.6.jar
                                            jcommon-1.0.16.jar
                                            jfreechart-1.0.13.jar
                                            miglayout-3.7.1-swing.jar"/>
        <attribute name="Main-Class" value="edu.jhuapl.near.ErosViewer"/>
      </manifest>
    </jar>
  </target>

  <target name="runjar" depends="jar">
    <java classname="edu.jhuapl.near.ErosViewer" fork="true"
          maxmemory="512m">
      <jvmarg value="-Djava.library.path=${rootdir}/lib/linux32"/>
      <jvmarg value="-Dsun.java2d.noddraw=true"/>
      <classpath>
		<pathelement location="${rootdir}/lib/vtk.jar"/>
		<pathelement location="${rootdir}/lib/jide-oss-2.7.3.jar"/>
		<pathelement location="${rootdir}/lib/joda-time-1.6.jar"/>
		<pathelement location="${rootdir}/lib/jcommon-1.0.16.jar"/>
        <pathelement location="${rootdir}/lib/jfreechart-1.0.13.jar"/>
        <pathelement location="${rootdir}/lib/miglayout-3.7.1-swing.jar"/>
		<pathelement location="${rootdir}/build/jar/near.jar"/>
      </classpath>
    </java>
  </target>

  <target name="nativelinuxvtkjar">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/vtk-natives-linux-i586.jar" basedir="${rootdir}/lib/linux32">
      <manifest>
      </manifest>
    </jar>
  </target>

  <target name="nativelinux64vtkjar">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/vtk-natives-linux-amd64.jar" basedir="${rootdir}/lib/linux64">
      <manifest>
      </manifest>
    </jar>
  </target>

  <target name="nativewinvtkjar">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/vtk-natives-windows-i586.jar" basedir="${rootdir}/lib/win32">
      <manifest>
      </manifest>
    </jar>
  </target>

  <target name="nativemac32vtkjar">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/vtk-natives-macosx-universal.jar" basedir="${rootdir}/lib/mac32">
      <manifest>
      </manifest>
    </jar>
  </target>

  <target name="nativemac64vtkjar">
    <mkdir dir="${rootdir}/build/jar"/>
    <jar destfile="${rootdir}/build/jar/vtk-natives-macosx-x86_64.jar" basedir="${rootdir}/lib/mac64">
      <manifest>
      </manifest>
    </jar>
  </target>

  <!--

      The next target assumes that you have file named "keystore" in
      the root directory which was created using the java keytool
      command with the alias called "mykey". For example, I used the
      command while in rootdir

      ${JAVA_HOME}/bin/keytool -genkey -keystore keystore -validity 1000000

    -->
  <target name="signjar" depends="jar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/near.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signvtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/vtk.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signnativelinuxvtkjar" depends="nativelinuxvtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/vtk-natives-linux-i586.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signnativelinux64vtkjar" depends="nativelinux64vtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/vtk-natives-linux-amd64.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signnativewinvtkjar" depends="nativewinvtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/vtk-natives-windows-i586.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signnativemac32vtkjar" depends="nativemac32vtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/vtk-natives-macosx-universal.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signnativemac64vtkjar" depends="nativemac64vtkjar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/build/jar/vtk-natives-macosx-x86_64.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signjidejar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/jide-oss-2.7.3.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signjodatimejar">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/joda-time-1.6.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signjcommon">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/jcommon-1.0.16.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signjfreechart">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/jfreechart-1.0.13.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>

  <target name="signmiglayout">
    <input message="Please enter keystore password:"
           addproperty="keypass" />
    <signjar jar="${rootdir}/lib/miglayout-3.7.1-swing.jar"
             keystore="${rootdir}/keystore" alias="mykey"
             storepass="${keypass}"/>
  </target>


  <target name="clean">
    <delete dir="${rootdir}/build"/>
  </target>

</project>
